<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="utf-8">
        <link rel="manifest" href="manifest.json">
        <title>TaskBoard Widget</title>
    </head>

    <body>
        <h1>TaskBoard</h1>
        <!-- dropdown for task lists -->
        <select id="list-select"></select>
        <button id="load">Charger les t√¢ches</button>
        <ul id="tasks"></ul>
        <script>
        // fetch and populate available task lists
        async function loadLists() {
        const res = await fetch('https://taskboard-widget.onrender.com/api/lists');
        const data = await res.json();
        if (data.needsAuth) { window.location = 'https://taskboard-widget.onrender.com/auth'; return; }
        const select = document.getElementById('list-select');
        select.innerHTML = '';
        data.lists.forEach(list => {
            const opt = document.createElement('option');
            opt.value = list.id;
            opt.textContent = list.title;
            select.appendChild(opt);
        });
        }

        // fetch and display tasks for selected list
        async function loadTasks() {
        const listId = document.getElementById('list-select').value;
        const res = await fetch('https://taskboard-widget.onrender.com/api/widget-data?listId=' + encodeURIComponent(listId));
        const data = await res.json();
        if (data.needsAuth) { window.location = 'https://taskboard-widget.onrender.com/auth'; return; }
        const tasksList = document.getElementById('tasks');
        tasksList.innerHTML = '';
        (data.tasks || []).forEach(t => {
            const li = document.createElement('li');
            li.textContent = t.title;
            tasksList.appendChild(li);
        });
        }

        document.getElementById('load').onclick = loadTasks;
        window.onload = async () => {
        await loadLists();
        await loadTasks();
        };
        </script>
        <script>
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
              navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registered:', reg))
                .catch(err => console.error('SW registration failed:', err));
            });
          }
        </script>
    </body>

</html>
